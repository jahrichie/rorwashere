version: "3.8"

services:
  web:
    build:
      context: .
      no_cache: true
    container_name: rorwashere

    # Local dev: expose on 8080. Production: Traefik handles routing via network
    ports:
      - "8080:80"

    volumes:
      - /Users/jahrichie/code/rorwashere:/usr/share/nginx/html:ro

    restart: unless-stopped

    networks:
      - proxy
      - default

    labels:
      - "traefik.enable=true"

      # Route rorwashere.com and www.rorwashere.com
      - "traefik.http.routers.rorwashere.rule=Host(`rorwashere.com`) || Host(`www.rorwashere.com`)"
      - "traefik.http.routers.rorwashere.entrypoints=websecure"
      - "traefik.http.routers.rorwashere.tls=true"
      - "traefik.http.routers.rorwashere.tls.certresolver=le"

      # Nginx listens on port 80 inside the container
      - "traefik.http.services.rorwashere.loadbalancer.server.port=80"

networks:
  proxy:
    external: true
  default:
    driver: bridge